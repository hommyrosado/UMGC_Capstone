<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Downloader</title>
<style>
  /* General page styling */
  body {
    font-family: Arial;
    background: #f0f0f0;
    padding: 30px;
  }

  .container {
    max-width: 900px; /* from B: more space than A */
    margin: auto;
    background: #fff;
    padding: 30px; /* from B: more padding */
    border-radius: 10px;
  }

  input[type="text"] {
    width: 100%;
    padding: 10px;
    margin: 10px 0; /* from A */
    font-size: 1rem; /* from B */
    margin-bottom: 1rem; /* from B */
  }

  button {
    padding: 10px 20px;
    font-size: 1rem; /* from B */
    background: #0066cc; /* from B */
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  /* Video listing styles */
  .video {
    display: flex; /* from B */
    gap: 20px;
    margin-top: 20px;
    align-items: center;
    background: #fafafa;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    border-bottom: 1px solid #ccc; /* merged from A */
    padding-bottom: 20px; /* merged from A */
  }

  .video img {
    width: 200px; /* from B, A used 300px */
    border-radius: 5px;
    display: block;
  }

  .video a {
    text-decoration: none;
    color: black;
    font-weight: bold;
  }

  .video-title {
    font-weight: bold;
    font-size: 1.1rem;
  }

  .downloaded-icon {
    color: green;
    font-size: 1.5rem;
    margin-left: 10px;
    vertical-align: middle;
  }

  /* Modal styling */
  #downloadModal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    width: 400px;
  }

  #progressBar {
    width: 100%;
    height: 20px;
    border: 1px solid #000;
    margin: 20px 0;
  }

  #progressBarFill {
    width: 0%;
    height: 100%;
    background-color: #0066cc;
  }
</style>

</head>
<body>
<div class="container">
  <h1>Automatic YouTube Downloader</h1>
  <form method="POST">
    <input type="text" name="query" placeholder="Search topic or paste YouTube URL..." required>
    <button type="submit">Search</button>
  </form>

  {% if videos %}
  <div class="videos">
    {% for video in videos %}
    <div class="video">
      <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
      <div>
        <div class="video-title">
          {{ video.title }}
          {% if video.downloaded %}<span class="downloaded-icon">âœ”</span>{% endif %}
        </div>
        <button onclick="openModal('{{ video.video_id }}', '{{ video.title | escape }}')">Download</button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<!-- Modal -->
<div id="downloadModal">
  <div class="modal-content">
    <h3 id="modalTitle">Confirm Download</h3>
    <p>Download: <strong id="videoTitle"></strong>?</p>
    <div id="progressBar"><div id="progressBarFill"></div></div>
    <button onclick="startDownload()">Download</button>
    <button onclick="closeModal()" style="background:red;">Cancel</button>
  </div>
</div>

<script>
  let selectedVideoId = null;
  let progressInterval = null;

  function openModal(videoId, title) {
    selectedVideoId = videoId;
    document.getElementById("videoTitle").innerText = title;
    document.getElementById("progressBarFill").style.width = "0%";
    document.getElementById("downloadModal").style.display = "flex";
  }

  function closeModal() {
    clearInterval(progressInterval);
    document.getElementById("downloadModal").style.display = "none";
  }

  function startDownload() {
    let fill = document.getElementById("progressBarFill");
    let percent = 0;

    progressInterval = setInterval(() => {
      if (percent < 90) {
        percent += 5;
        fill.style.width = percent + "%";
      }
    }, 300);

    fetch("/start_download", {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ video_id: selectedVideoId })
    })
    .then(response => response.json())
    .then(data => {
      clearInterval(progressInterval);
      if (data.success) {
        fill.style.width = "100%";
        setTimeout(() => {
          window.location.href = `/download_file/${data.filename}`;
          closeModal();
        }, 500);
      } else {
        alert("Download failed: " + data.error);
        closeModal();
      }
    })
    .catch(err => {
      alert("Error: " + err);
      closeModal();
    });
  }
</script>
</body>
</html>
